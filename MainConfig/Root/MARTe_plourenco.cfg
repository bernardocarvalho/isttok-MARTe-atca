LoggerAddress = "localhost"
//LoggerAddress = "193.136.136.136"
LoggerPort = 32767
DefaultCPUs = 2
+OBJBROWSE = {
    Class = HttpClassListResource
    Fake = 1
}
+THRBROWSE = {
    Class = HttpThreadListResource
}
+BROWSE = {
    Title = "Http GCRC Browser"
    Class = HttpGCRCBrowser
    AddReference = {StateMachine MARTe OBJBROWSE THRBROWSE HTTPCFGUploader HTTPSignalServer}
}
+HTTPSERVER = {
    Class = HttpService
    Port = 8084
    VerboseLevel = 4
    Root = BROWSE
}
+HTTPCFGUploader = {
    Class = CFGUploader
}
+HTTPSignalServer = {
    Class = SignalServer
}
+StateMachine = {
    Class = StateMachine
    VerboseLevel = 10
    +INITIAL = {
        Class = StateMachineState
        StateCode = 0x0
        +START = {
            Class = StateMachineEvent
            NextState = IDLE
            Value = START
            +STARTALL = {
                Class = MessageDeliveryRequest
                Sender = StateMachine
                Destinations = "HTTPSERVER MARTe"
                MsecTimeOut = 10000 //1000
                Flags = NoReply
                Message = {
                    Class = Message
                    Content = START
                }
            }
        }
    }
    +IDLE = {
        Class = StateMachineState
        StateCode = 0x500
        +PULSE_SETUP_COMPLETED = {
            Class = StateMachineEvent
            Code = 0x701
            NextState = WAITING_FOR_PRE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = PREPULSECHECK
                }
            }
            +UPDATE_HTTP_SIGNAL_SERVER = {
                Class = MessageEnvelope
                Destination = HTTPSignalServer
                +MESSAGE = {
                    Class = Message
                    Content = AUTODETECT
                }
            }
        }
        +INHIBIT = {
            Class = StateMachineEvent
            Code = 0x704
            NextState = INHIBIT
        }
        +ACTIVATE = {
            Class = StateMachineEvent
            Code = 0x705
            NextState = SAMESTATE
        }
        +STOP = {
            Class = StateMachineEvent
            NextState = IDLE
            Value = STOP
            +STOPALL = {
                Class = MessageDeliveryRequest
                Sender = StateMachine
                Destinations = "HTTPSERVER MARTe"
                MsecTimeOut = 1000
                Flags = NoReply
                Message = {
                    Class = Message
                    Content = STOP
                }
            }
        }
    }
    +WAITING_FOR_PRE = {
        Class = StateMachineState
        StateCode = 0x504
        +PRE = {
            Class = StateMachineEvent
            Code = 0x708
            NextState = PULSING
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = PULSESTART
                }
            }
        }
        +COLLECTION_COMPLETED = {
            Class = StateMachineEvent
            Code = 0x703
            NextState = COMM_ERROR
        }
    }
    +PULSING = {
        Class = StateMachineState
        StateCode = 0x505
        +EJP = {
            Class = StateMachineEvent
            Code = 0x709
            NextState = POST_PULSE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = PULSESTOP
                }
            }
        }
    }
    +POST_PULSE = {
        Class = StateMachineState
        StateCode = 0x507
        +COLLECTION_COMPLETED = {
            Class = StateMachineEvent
            Code = 0x703
            NextState = IDLE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = COLLECTIONCOMPLETED
                }
            }
        }
    }
    +INHIBIT = {
        Class = StateMachineState
        StateCode = 0x508
        +ACTIVATE = {
            Class = StateMachineEvent
            Code = 0x705
            NextState = IDLE
        }
    }
    +ERROR = {
        Class = StateMachineState
        StateCode = 0x601
        +ACTIVATE = {
            Class = StateMachineEvent
            Code = 0x705
            NextState = INIT
        }
        +COLLECTION_COMPLETED = {
            Class = StateMachineEvent
            Code = 0x703
            NextState = INIT
        }
    }
    +UNRECOVERABLE = {
        Class = StateMachineState
        StateCode = 0x601
        +DEFAULT = {
            Class = StateMachineEvent
            UserCode = 0
            NextState = UNRECOVERABLE
        }
    }
    +COMM_ERROR = {
        StateCode = 0x601
        Class = StateMachineState
        +ABORT = {
            Class = StateMachineEvent
            Code = 0x702
            NextState = SAMESTATE
        }
    }
    +DEFAULT = {
        Class = StateMachineState
        StateCode = 0x601
        +ABORT = {
            Class = StateMachineEvent
            Code = 0x702
            NextState = IDLE
        }
        +PRE = {
            Class = StateMachineEvent
            Code = 0x708
            NextState = SAMESTATE
        }
        +EJP = {
            Class = StateMachineEvent
            Code = 0x709
            NextState = SAMESTATE
        }
    }
}
+MARTeMenu = {
    Class = MarteSupLib::MARTeMenu
    Title = "MARTe Menu"
    +MenuA = {
        Class = MenuContainer
        Title = "CODAS Interface"
        +ABORT = {
            Class = SendMessageMenuEntry
            Title = Abort
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x702
                    Content = ABORT
                }
            }
        }
        +INHIBIT = {
            Class = SendMessageMenuEntry
            Title = Inhibit
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x704
                    Content = Inhibit
                }
            }
        }
        +ACTIVATE = {
            Class = SendMessageMenuEntry
            Title = Activate
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x705
                    Content = Activate
                }
            }
        }
        +PULSESETUPCOMPLETE = {
            Class = SendMessageMenuEntry
            Title = "Pulse Setup Complete"
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x701
                    Content = WAITING_FOR_PRE
                }
            }
        }
        +PRE = {
            Class = SendMessageMenuEntry
            Title = "Pulse Start"
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x708
                    Content = PRE
                }
            }
        }
        +EJP = {
            Class = SendMessageMenuEntry
            Title = "Pulse End"
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x709
                    Content = EJP
                }
            }
        }
        +COLLECTIONCOMPLETED = {
            Class = SendMessageMenuEntry
            Title = "Collection Completed"
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x703
                    Content = POSTPULSE
                }
            }
        }
    }
    AddReference = MARTe.MARTe
}

+MARTe = {
    Class = MARTeContainer
    StateMachineName = StateMachine
    Level1Name = LEVEL1
    MenuContainerName = MARTe
    +MARTe = {
        Class = MenuContainer
    }
    +DriverPool = {
        Class = GCReferenceContainer
        +TimerBoard = {
            Class = GenericTimerDrv
            NumberOfInputs = 2
            NumberOfOutputs = 0
            TimerUsecPeriod = 1000 //100
            SynchronizationMethod = Synchronizing
            CPUMask = 1
        }
    }
    +Messages = {
        Class = GCReferenceContainer
        +FatalErrorMessage = {
            Class = MessageDeliveryRequest
            Destinations = StateMachine
            MsecTimeOut = 10000 //1000
            Flags = NoReply
            Message = {
                Class = Message
                Code = 0x776
                Content = UNRECOVERABLE
            }
        }
        +ConfigLoadErrorMessage = {
            Class = MessageDeliveryRequest
            Destinations = StateMachine
            MsecTimeOut = 10000 //1000
            Flags = NoReply
            Message = {
                Class = Message
                Code = 0x777
                Content = CONFIG_ERROR
            }
        }
        +ConfigLoadOKMessage = {
            Class = MessageDeliveryRequest
            Destinations = StateMachine
            MsecTimeOut = 1000
            Flags = NoReply
            Message = {
                Class = Message
                Code = 0x778
                Content = CONFIG_OK
            }
        }
        +SafetyErrorMessage = {
            Class = MessageDeliveryRequest
            Destinations = MARTe
            MsecTimeOut = 10000 //1000
            Flags = NoReply
            Message = {
                Class = Message
                Content = ERROR
            }
        }
    }
    +ExternalTimeTriggeringService = {
        Class = InterruptDrivenTTS
        TsOnlineUsecPeriod = 1000 //100
        TsOnlineUsecPhase = 0
        TsOfflineUsecPeriod = 1000 //100
        TsOfflineUsecPhase = 0
        TimeModule = {
            BoardName = TimerBoard
        }
    }
    +RealTimeThread = {
        Class = RealTimeThread
        ThreadPriority = 0
        RunOnCPU = 4
        RTStatusChangeMsecTimeout = 10000 //1000
        SMStatusChangeMsecTimeout = 10000 //1000
        OfflineSemaphoreTimeout = 1000 //100
        TriggeringServiceName = MARTe.ExternalTimeTriggeringService
        SafetyMsecSleep = 1
        +DDB = {
            Class = DDB
            Fake = 1
        }
        
        +Timer = {
            Class = IOGAMs::TimeInputGAM
            TriggeringServiceName = ExternalTimeTriggeringService
            BoardName = TimerBoard
            Signals = {
                time = {
                    SignalName = usecTime
                    SignalType = int32
                }
                counter = {
                    SignalName = counter
                    SignalType = int32
                }
            }
        }
        
		+simulate_dischargestatus = {
            Class = SimulateDischargeStatus
            shot_number = 40312
            output_signals = {
                Mirnov0 = {
                    SignalName = ADC_magnetic_chopper_fp_0
                    SignalType = int32
                }
                Mirnov1 = {
                    SignalName = ADC_magnetic_chopper_fp_1
                    SignalType = int32
                }
                Mirnov2 = {
                    SignalName = ADC_magnetic_chopper_fp_2
                    SignalType = int32
                }
                Mirnov3 = {
                    SignalName = ADC_magnetic_chopper_fp_3
                    SignalType = int32
                }
                Mirnov4 = {
                    SignalName = ADC_magnetic_chopper_fp_4
                    SignalType = int32
                }
                Mirnov5 = {
                    SignalName = ADC_magnetic_chopper_fp_5
                    SignalType = int32
                }
                Mirnov6 = {
                    SignalName = ADC_magnetic_chopper_fp_6
                    SignalType = int32
                }
                Mirnov7 = {
                    SignalName = ADC_magnetic_chopper_fp_7
                    SignalType = int32
                }
                Mirnov8 = {
                    SignalName = ADC_magnetic_chopper_fp_8
                    SignalType = int32
                }
                Mirnov9 = {
                    SignalName = ADC_magnetic_chopper_fp_9
                    SignalType = int32
                }
                Mirnov10 = {
                    SignalName = ADC_magnetic_chopper_fp_10
                    SignalType = int32
                }
                Mirnov11 = {
                    SignalName = ADC_magnetic_chopper_fp_11
                    SignalType = int32
                }

            }
        }
        
        +magnetic_probes = {
            Class = MagneticsGAM
            usectime_to_wait_for_starting_operation = 10000 //1000
            magnetic_radial_bool = 0
            magnetic_vertical_bool = 0
            magnetic_module_correction_bool = 1
            MirnovArrayDescription = {
                NumberOfProbes = 12
                Angles = {3.450000e+02 3.150000e+02 2.850000e+02 2.550000e+02 2.250000e+02 1.950000e+02 1.650000e+02 1.350000e+02 1.050000e+02 7.500000e+01 4.500000e+01 1.500000e+01}
                Calibration = {1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00}
            }
            Measurements = {
                NumberOfMeasurements = 12
                ProbeNumbers = {0 1 2 3 4 5 6 7 8 9 10 11}
            }
            ModuleOffsetCorrectionLSBusec = {
				NumberOfModules = 12
                OffsetCalibration = {654544 309259 451885 -1.20534e+06 1.36202e+06 757949 711021 1.58308e+06 755415 481147 -1.3262e+06 509076}
                //OffsetCalibration = {39.6358 19.1801 27.4524 -73.7103 83.2007 45.8257 43.4746 96.8603 46.1042 29.2206 -80.9886 31.0644}
                PolarityCalibration = {1.0 1.0 -1.0 1.0 -1.0 -1.0 -1.0 -1.0 -1.0 -1.0 1.0 -1.0}
                //PolarityCalibration = {1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0}
            }
            input_signals = {
                Channel_0 = {
                    SignalName = ADC_magnetic_chopper_fp_0
                    SignalType = int32
                }
                Channel_1 = {
                    SignalName = ADC_magnetic_chopper_fp_1
                    SignalType = int32
                }
                Channel_2 = {
                    SignalName = ADC_magnetic_chopper_fp_2
                    SignalType = int32
                }
                Channel_3 = {
                    SignalName = ADC_magnetic_chopper_fp_3
                    SignalType = int32
                }
                Channel_4 = {
                    SignalName = ADC_magnetic_chopper_fp_4
                    SignalType = int32
                }
                Channel_5 = {
                    SignalName = ADC_magnetic_chopper_fp_5
                    SignalType = int32
                }
                Channel_6 = {
                    SignalName = ADC_magnetic_chopper_fp_6
                    SignalType = int32
                }
                Channel_7 = {
                    SignalName = ADC_magnetic_chopper_fp_7
                    SignalType = int32
                }
                Channel_8 = {
                    SignalName = ADC_magnetic_chopper_fp_8
                    SignalType = int32
                }
                Channel_9 = {
                    SignalName = ADC_magnetic_chopper_fp_9
                    SignalType = int32
                }
                Channel_10 = {
                    SignalName = ADC_magnetic_chopper_fp_10
                    SignalType = int32
                }
                Channel_11 = {
                    SignalName = ADC_magnetic_chopper_fp_11
                    SignalType = int32
                }
                time = {
                    SignalName = usecTime
                    SignalType = int32
                }
            }
            output_signals = {
                magnetic_probes_r = {
                    SignalName = MagneticProbesR
                    SignalType = float
                    Cal0 = 0.0
                    Cal1 = 1.0                    
                }
                magnetic_probes_z = {
                    SignalName = MagneticProbesZ
                    SignalType = float
                    Cal0 = 0.0
                    Cal1 = 1.0                    
                }
                magnetic_probes_plasma_current = {
                    SignalName = MagneticProbesPlasmaCurrent
                    SignalType = float
                    Cal0 = 0.0
                    Cal1 = 1.0
                }
            }
        }
           
		+DataCollection = {
            Class = CollectionGAMs::DataCollectionGAM
            UsecTimeSignalName = usecTime
            EventTrigger = {
                TimeWindow0 = {
                    NOfSamples = 10000
                    UsecPeriod = 1000 //100
                }
            }
            NOfAcquisitionSamples = 100000
            Signals = {
                timeBase = {
                    SignalName = usecTime
                    SignalType = int32
                    JPFName = TimeBase
                    Cal0 = 0
                    Cal1 = 1.0e-6
                }
                Channel_001 = {
                    SignalName = MagneticProbesR
                    SignalType = float
                    JPFName = MagneticProbesR
                    Cal0 = 0.0
                    Cal1 = 1.0
                }
                Channel_002 = {
                    SignalName = MagneticProbesZ
                    SignalType = float
                    JPFName = MagneticProbesZ
                    Cal0 = 0.0
                    Cal1 = 1.0
                }
                Channel_003 = {
                    SignalName = MagneticProbesPlasmaCurrent
                    SignalType = float
                    JPFName = MagneticProbesPlasmaCurrent
                    Cal0 = 0.0
                    Cal1 = 1.0
                }
                Channel_004 = {
                    SignalName = ADC_magnetic_chopper_fp_0
                    SignalType = int32
                    JPFName = ADC_magnetic_chopper_fp_0
                }
            }
        }

        Online = "Timer simulate_dischargestatus magnetic_probes DataCollection"
        Offline = "Timer simulate_dischargestatus magnetic_probes DataCollection"
        Safety = "simulate_dischargestatus magnetic_probes DataCollection"
    }
}

