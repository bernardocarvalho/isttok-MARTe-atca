version = "$Id$"
LoggerAddress = "localhost"
DefaultCPUs = 2
+WEB = {
    Class = HttpGroupResource
    +BROWSE = {
        Title = "Http Object Browser"
        Class = HttpGCRCBrowser
        AddReference = {MARTe StateMachine OBJBROWSE THRBROWSE CFGUpload HTTPSignalServer MatlabSignalServer}
    }
}
+HTTPSERVER = {
    Class = HttpService
    Port = 8086
    HttpRelayURL = "ignore.me:1234"
    VerboseLevel = 10
    Root = WEB
}
+OBJBROWSE = {
    Class = HttpClassListResource
}
+THRBROWSE = {
    Class = HttpThreadListResource
}
+MatlabSignalServer = {
    Class = MATLABHandler
}
+HTTPSignalServer={
     Class = SignalServer
}
+CFGUpload = {
    Class = CFGUploader
}
+StateMachine = {
    Class = StateMachine
    VerboseLevel = 10
    +INITIAL = {
        Class = StateMachineState
        StateCode = 0x0
        +START = {
            Class = StateMachineEvent
            NextState = IDLE
            Value = START
            +STARTALL = {
                Class = MessageDeliveryRequest
                Sender = StateMachine
                Destinations = "HTTPSERVER MARTe"
                MsecTimeOut = 1000
                Flags = NoReply
                Message = {
                    Class = Message
                    Content = START
                }
            }
        }
    }
    +IDLE = {
        Class = StateMachineState
        StateCode = 0x500
        +PULSE_SETUP_COMPLETED = {
            Class = StateMachineEvent
            Code = 0x701
            NextState = WAITING_FOR_TRIGGER
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = PREPULSECHECK
                }
            }
            +UPDATE_MSS = {
                Class = MessageEnvelope
                Destination = MatlabSignalServer
                +MESSAGE = {
                    Class = Message
                    Content = AUTODETECT
                }
            }
			+UPDATE_SS = {
                Class = MessageEnvelope
                Destination = HTTPSignalServer
                +MESSAGE = {
                    Class = Message
                    Content = AUTODETECT
                }
            }
        }
        +INHIBIT = {
            Class = StateMachineEvent
            Code = 0x704
            NextState = INHIBIT
        }
        +ACTIVATE = {
            Class = StateMachineEvent
            Code = 0x705
            NextState = SAMESTATE
        }
        +UNRECOVERABLE = {
            Class = StateMachineEvent
            Code = 0x776
            NextState = UNRECOVERABLE
        }
        +CONFIG_ERROR = {
            Class = StateMachineEvent
            Code = 0x777
            NextState = CONFIG_ERROR
        }
        +CONFIG_OK = {
            Class = StateMachineEvent
            Code = 0x778
            NextState = SAMESTATE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = COULD.BE.A.MIMIC
                +SENDSTATE = {
                    Class = Message
                    Code = 0x500
                }
            }
        }
        +STOP = {
            Class = StateMachineEvent
            NextState = IDLE
            Value = STOP
            Code = 0x005
            +STOPALL = {
                Class = MessageDeliveryRequest
                Sender = StateMachine
                Destinations = "HTTPSERVER MARTe"
                MsecTimeOut = 1000
                Flags = NoReply
                Message = {
                    Class = Message
                    Content = STOP
                }
            }
        }
    }
    +WAITING_FOR_TRIGGER = {
        Class = StateMachineState
        StateCode = 0x504
        +TRIGGER = {
            Class = StateMachineEvent
            Code = 0x708
            NextState = PULSING
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = PULSESTART
                }
            }
        }
        +ABORT = {
            Class = StateMachineEvent
            Code = 0x702
            NextState = IDLE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = PULSESTOP
                }
            }
        }
        +COLLECTION_COMPLETED = {
            Class = StateMachineEvent
            Code = 0x703
            NextState = COMM_ERROR
        }
    }
    +PULSING = {
        Class = StateMachineState
        StateCode = 0x505
        +ENTER = {
            Class = MessageEnvelope
            Destination = COULD.BE.A.MIMIC
            +SENDSTATE = {
                Class = Message
            }
        }
        +ABORT = {
            Class = StateMachineEvent
            Code = 0x702
            NextState = IDLE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = PULSESTOP
                }
            }
        }
        +END_PULSE = {
            Class = StateMachineEvent
            Code = 0x709
            NextState = POST_PULSE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = PULSESTOP
                }
            }
        }
    }
    +POST_PULSE = {
        Class = StateMachineState
        StateCode = 0x507
        +ENTER = {
            Class = MessageEnvelope
            Destination = COULD.BE.A.MIMIC
            +SENDSTATE = {
                Class = Message
            }
        }
        +COLLECTION_COMPLETED = {
            Class = StateMachineEvent
            Code = 0x703
            NextState = IDLE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = MARTe
                +MESSAGE = {
                    Class = Message
                    Content = COLLECTIONCOMPLETED
                }
            }
        }
    }
    +INHIBIT = {
        Class = StateMachineState
        StateCode = 0x508
        +ACTIVATE = {
            Class = StateMachineEvent
            Code = 0x705
            NextState = IDLE
        }
    }
    +ERROR = {
        Class = StateMachineState
        StateCode = 0x601
        +ACTIVATE = {
            Class = StateMachineEvent
            Code = 0x705
            NextState = IDLE
        }
        +COLLECTION_COMPLETED = {
            Class = StateMachineEvent
            Code = 0x703
            NextState = IDLE
        }
    }
    +CONFIG_ERROR = {
        Class = StateMachineState
        StateCode = 0x601
        +ENTER = {
            Class = MessageEnvelope
            Destination = COULD.BE.A.MIMIC
            +SENDSTATE = {
                Class = Message
            }
        }
        +ACTIVATE = {
            Class = StateMachineEvent
            Code = 0x705
            NextState = IDLE
        }
        +CONFIG_OK = {
            Class = StateMachineEvent
            Code = 0x778
            NextState = IDLE
            +NOTIFY = {
                Class = MessageEnvelope
                Sender = StateMachine
                Destination = COULD.BE.A.MIMIC
                +SENDSTATE = {
                    Class = Message
                    Code = 0x500
                }
            }
        }
	+CONFIG_ERROR = {
            Class = StateMachineEvent
            Code = 0x777
            NextState = CONFIG_ERROR
        }
    }
    +UNRECOVERABLE = {
        Class = StateMachineState
        StateCode = 0x601
        +DEFAULT = {
            Class = StateMachineEvent
            UserCode = 0
            NextState = UNRECOVERABLE
        }
    }
    +COMM_ERROR = {
        StateCode = 0x601
        Class = StateMachineState
        +ABORT = {
            Class = StateMachineEvent
            Code = 0x702
            NextState = SAMESTATE
        }
    }
    +DEFAULT = {
        Class = StateMachineState
        StateCode = 0x601
        +ABORT = {
            Class = StateMachineEvent
            Code = 0x702
            NextState = IDLE
        }
        +TRIGGER = {
            Class = StateMachineEvent
            Code = 0x708
            NextState = SAMESTATE
        }
        +END_PULSE = {
            Class = StateMachineEvent
            Code = 0x709
            NextState = SAMESTATE
        }
    }
}
+MARTeMenu = {
    Class = MarteSupLib::MARTeMenu
    Title = "MARTe Menu"
    +MenuA = {
        Class = MenuContainer
        Title = "State Machine"
        +ABORT = {
            Class = SendMessageMenuEntry
            Title = Abort
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x702
                    Content = ABORT
                }
            }
        }
        +INHIBIT = {
            Class = SendMessageMenuEntry
            Title = Inhibit
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x704
                    Content = Inhibit
                }
            }
        }
        +ACTIVATE = {
            Class = SendMessageMenuEntry
            Title = Activate
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x705
                    Content = Activate
                }
            }
        }
        +PULSESETUPCOMPLETE = {
            Class = SendMessageMenuEntry
            Title = "Pulse Setup Complete"
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x701
                    Content = WAITING_FOR_TRIGGER
                }
            }
        }
        +TRIGGER = {
            Class = SendMessageMenuEntry
            Title = "Pulse Start"
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x708
                    Content = TRIGGER 
                }
            }
        }
        +END_PULSE = {
            Class = SendMessageMenuEntry
            Title = "Pulse End"
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x709
                    Content = END_PULSE 
                }
            }
        }
        +COLLECTIONCOMPLETED = {
            Class = SendMessageMenuEntry
            Title = "Collection Completed"
            Envelope = {
                Class = MessageEnvelope
                Sender = MARTeMenu
                Destination = StateMachine
                +Message = {
                    Class = Message
                    Code = 0x703
                    Content = POSTPULSE
                }
            }
        }
    }
    AddReference = MARTe.MARTe
}
+MARTe = {
    Class = MARTeContainer
    StateMachineName = StateMachine
    Level1Name = LEVEL1
    MenuContainerName = MARTe
    +MARTe = {
        Class = MenuContainer
    }
    +DriverPool = {
        Class = GCReferenceContainer        
	     +ATCAIocInt = {
		    Class = ATCAIocIntDrv
                    NumberOfInputs = 32
		    NumberOfOutputs = 0
            	    DeviceFileName = "/dev/atca_ioc_int11"
		    CpuMask = 4
	    }
    }
    +Messages = {
        Class = GCReferenceContainer
        +FatalErrorMessage = {
            Class = MessageDeliveryRequest
            Destinations = StateMachine
            MsecTimeOut = 1000
            Flags = NoReply
            Message = {
                Class = Message
                Code = 0x776
                Content = UNRECOVERABLE
            }
        }
        +ConfigLoadErrorMessage = {
            Class = MessageDeliveryRequest
            Destinations = StateMachine
            MsecTimeOut = 1000
            Flags = NoReply
            Message = {
                Class = Message
                Code = 0x777
                Content = CONFIG_ERROR
            }
        }
        +ConfigLoadOKMessage = {
            Class = MessageDeliveryRequest
            Destinations = StateMachine
            MsecTimeOut = 1000
            Flags = NoReply
            Message = {
                Class = Message
                Code = 0x778
                Content = CONFIG_OK
            }
        }
        +SafetyErrorMessage = {
            Class = MessageDeliveryRequest
            Destinations = MARTe
            MsecTimeOut = 1000
            Flags = NoReply
            Message = {
                Class = Message
                Content = ERROR
            }
        }
    }
    +ExternalTimeTriggeringService = {
        Class = InterruptDrivenTTS
        TsOnlineUsecPeriod = 100
        TsOnlineUsecPhase = 0
        TsOfflineUsecPeriod = 100
        TsOfflineUsecPhase = 0
        TimeModule = {            
		BoardName = ATCAIocInt
        }
    }
    +Thread_1 = {
        Class = RealTimeThread
        ThreadPriority = 28
        RunOnCPU = 4
        RTStatusChangeMsecTimeout = 1000
        SMStatusChangeMsecTimeout = 1000
        OfflineSemaphoreTimeout = 50
        TriggeringServiceName = MARTe.ExternalTimeTriggeringService
        SafetyMsecSleep = 1
        +DDB = {
            Class = DDB
        }        
	+ATCAAdcInt = {
       		Class = IOGAMs::TimeInputGAM
			TriggeringServiceName = ExternalTimeTriggeringService
			BoardName = ATCAIocInt
			Signals = {
        			Channel_000 = {
					SignalName = ADC_INT_mirnov_0
					SignalType = float
                    			Cal0 = 0
                    			Cal1 = 1.0
                	 	}
        			Channel_001 = {
					SignalName = ADC_INT_mirnov_1
					SignalType = float
                    			Cal0 = 0
                    			Cal1 = 1.0
                	 	}
        			Channel_002 = {
					SignalName = ADC_INT_mirnov_2
					SignalType = float
                    			Cal0 = 0
                    			Cal1 = 1.0
                	 	}
        			Channel_003 = {
					SignalName = ADC_INT_mirnov_3
					SignalType = float
                    			Cal0 = 0
                    			Cal1 = 1.67847e-4
                	 	}
				Channel_004 = {
		                    SignalName = ADC_INT_mirnov_4
				    SignalType = int32
                	 	}
				Channel_005 = {
		                    SignalName = ADC_INT_mirnov_5
				    SignalType = int32
                	 	}
				Channel_006 = {
		                    SignalName = ADC_INT_mirnov_6
				    SignalType = int32
                	 	}
				Channel_007 = {
		                    SignalName = ADC_INT_mirnov_7
				    SignalType = int32
                	 	}
				Channel_008 = {
		                    SignalName = ADC_INT_mirnov_8
				    SignalType = int32
                	 	}
				Channel_009 = {
		                    SignalName = ADC_INT_mirnov_9
				    SignalType = int32
                	 	}
				Channel_010 = {
		                    SignalName = ADC_INT_mirnov_10
				    SignalType = int32
                	 	}
				Channel_011 = {
		                    SignalName = ADC_INT_mirnov_11
				    SignalType = int32
                	 	}
				Channel_012 = {
		                    SignalName = ADC_INT_mirnov_12
				    SignalType = int32
                	 	}
				Channel_013 = {
		                    SignalName = ADC_INT_mirnov_13
				    SignalType = int32
                	 	}
				Channel_014 = {
		                    SignalName = ADC_INT_mirnov_14
				    SignalType = int32
                	 	}
				Channel_015 = {
		                    SignalName = ADC_INT_mirnov_15
				    SignalType = int32
                	 	}
				Channel_016 = {
		                    SignalName = ADC_INT_mirnov_16
				    SignalType = int32
                	 	}
				Channel_017 = {
		                    SignalName = ADC_INT_mirnov_17
				    SignalType = int32
                	 	}
				Channel_018 = {
		                    SignalName = ADC_INT_mirnov_18
				    SignalType = int32
                	 	}
				Channel_019 = {
		                    SignalName = ADC_INT_mirnov_19
				    SignalType = int32
                	 	}
				Channel_020 = {
		                    SignalName = ADC_INT_mirnov_20
				    SignalType = int32
                	 	}
				Channel_021 = {
		                    SignalName = ADC_INT_mirnov_21
				    SignalType = int32
                	 	}
				Channel_022 = {
		                    SignalName = ADC_INT_mirnov_22
				    SignalType = int32
                	 	}
				Channel_023 = {
		                    SignalName = ADC_INT_mirnov_23
				    SignalType = int32
                	 	}
				Channel_024 = {
		                    SignalName = ADC_INT_mirnov_24
				    SignalType = int32
                	 	}
				Channel_025 = {
		                    SignalName = ADC_INT_mirnov_25
				    SignalType = int32
                	 	}
				Channel_026 = {
		                    SignalName = ADC_INT_mirnov_26
				    SignalType = int32
                	 	}
				Channel_027 = {
		                    SignalName = ADC_INT_mirnov_27
				    SignalType = int32
                	 	}
				Channel_028 = {
		                    SignalName = ADC_INT_mirnov_28
				    SignalType = int32
                	 	}
				Channel_029 = {
		                    SignalName = ADC_INT_mirnov_29
				    SignalType = int32
                	 	}
				packetNumber = {
					SignalName = packetNumber
					SignalType = int32
				}
				usecTime = {
					SignalName = usecTime
					SignalType = uint32
				}
			}
        }
        +Statistic = {
            Class = WebStatisticGAM
            Verbose = True
            FrequencyOfVerbose = 2000000
            Signals = {
		     packetNumber = {
		     		  SignalName = packetNumber
				  SignalType = int32
		     }
                     SignalU = {
                         SignalName = usecTime
                    	 SignalType = uint32
               	     }
                     Channel0 = {
				SignalName = ADC_INT_mirnov_0
				SignalType = float
                     }
                     Channel1 = {
				SignalName = ADC_INT_mirnov_1
				SignalType = float
                     }
                     Channel2 = {
				SignalName = ADC_INT_mirnov_2
				SignalType = float
                     }
                     Channel4 = {
				SignalName = ADC_INT_mirnov_4
				SignalType = int32
                     }
        	     Signal0 = {
                     	     SignalName = CycleUsecTime
                    	     SignalType = float
                     }
                     Signal9 = {
                     	     SignalName = StatisticAbsoluteUsecTime
                    	     SignalType = float
                     }
                     Signal15 = {
                     	      SignalName = StatisticRelativeUsecTime
                    	      SignalType = float
               	     }
            }
        }
        +Collection = {
            Class = CollectionGAMs::DataCollectionGAM
            UsecTimeSignalName = usecTime
            TimeSignalType = uint32
            EventTrigger = {
                TimeWindow0 = {
                    NOfSamples = 400
                    UsecPeriod = 1000
                }
            }
            NOfAcquisitionSamples = 400
            Signals = {
                CLOCK = {
                    SignalName = usecTime
                    JPFName = "TIME"
                    SignalType = uint32
                    Cal0 = 0.0
                    Cal1 = 1.000000e-06
                }
                CycleTime = {
                    SignalName = CycleUsecTime
                    JPFName = "CycleTime"
                    SignalType = float
                }                
                Channel0 = {
                    SignalName = ADC_INT_mirnov_0
                    JPFName = "Channel1"
                    SignalType = float
                }
                Channel1 = {
                    SignalName = ADC_INT_mirnov_1
                    JPFName = "Channel1"
                    SignalType = float
                }
                Channel2 = {
                    SignalName = ADC_INT_mirnov_2
                    JPFName = "Channel2"
                    SignalType = float
                }
	    }
	}
        Online = "ATCAAdcInt Statistic Collection"
        Offline = "ATCAAdcInt Statistic Collection"
    }
}
ReloadAll = 0
